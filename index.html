<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alberta Wind (ECCC HRDPS)</title>

  <style>
    html, body { height: 100%; margin: 0; background: #000; overflow: hidden; }
    #app { position: fixed; inset: 0; }
    #badge {
      position: fixed;
      top: 12px; left: 12px;
      z-index: 9999;
      padding: 8px 10px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      font: 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>

<body>
  <div id="app"></div>
  <div id="badge">Alberta Wind â€¢ ECCC HRDPS</div>

  <!--
    IMPORTANT: Order matters for this fork:
    jQuery -> underscore -> backbone -> d3 -> topojson -> when -> your src/*.js
  -->

  <!-- jQuery + underscore + backbone (micro.js expects Backbone) -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/backbone@1.4.1/backbone-min.js"></script>

  <!-- d3 v3 (older earth.js/micro.js code relies on d3.v3 APIs like d3.set) -->
  <script src="https://cdn.jsdelivr.net/npm/d3@3.5.17/d3.min.js"></script>

  <!-- topojson (your cdnjs link returned HTML; jsdelivr is reliable) -->
  <script src="https://cdn.jsdelivr.net/npm/topojson@1.6.27/topojson.min.js"></script>

  <!-- when.js: use a browser global build (avoid CommonJS/AMD module errors) -->
  <script src="https://cdn.jsdelivr.net/npm/when@3.7.8/when.js"></script>

  <!-- Your local engine files -->
  <script src="src/micro.js"></script>
  <script src="src/globes.js"></script>
  <script src="src/products.js"></script>
  <script src="src/earth.js"></script>

  <script>
    (function boot() {
      // Default to Alberta product if no state is specified.
      if (!location.hash || location.hash === "#") {
        location.hash = "param=alberta_wind";
      }

      function startEarth() {
        try {
          // Common patterns across earth forks:
          if (window.earth && typeof window.earth.run === "function") return window.earth.run();
          if (window.earth && typeof window.earth.init === "function") return window.earth.init();
          if (window.earth && typeof window.earth.start === "function") return window.earth.start();
          if (window.earth && typeof window.earth === "function") return window.earth();

          if (window.Earth && typeof window.Earth.run === "function") return window.Earth.run();
          if (window.Earth && typeof window.Earth.init === "function") return window.Earth.init();
          if (window.Earth && typeof window.Earth.start === "function") return window.Earth.start();
          if (window.Earth && typeof window.Earth === "function") return window.Earth();

          // If we got here, earth.js loaded but didn't expose a known entrypoint.
          console.error("Earth loaded but no known start function found. Search src/earth.js for 'init(' or 'run(' and tell me what it exports.");
        } catch (e) {
          console.error("Earth failed to start:", e);
        }
      }

      // Delay one tick so globals settle
      setTimeout(startEarth, 0);
    })();
  </script>
</body>
</html>
